{"ast":null,"code":"// Generated by CoffeeScript 1.7.1\n(function () {\n  var AI, AL, BA, BK, CB, CI_BRK, CJ, CP_BRK, CR, DI_BRK, ID, IN_BRK, LF, LineBreaker, NL, NS, PR_BRK, SA, SG, SP, UnicodeTrie, WJ, XX, base64, characterClasses, classTrie, data, fs, pairTable, _ref, _ref1;\n\n  UnicodeTrie = require('unicode-trie');\n  fs = require('fs');\n  base64 = require('base64-js');\n  _ref = require('./classes'), BK = _ref.BK, CR = _ref.CR, LF = _ref.LF, NL = _ref.NL, CB = _ref.CB, BA = _ref.BA, SP = _ref.SP, WJ = _ref.WJ, SP = _ref.SP, BK = _ref.BK, LF = _ref.LF, NL = _ref.NL, AI = _ref.AI, AL = _ref.AL, SA = _ref.SA, SG = _ref.SG, XX = _ref.XX, CJ = _ref.CJ, ID = _ref.ID, NS = _ref.NS, characterClasses = _ref.characterClasses;\n  _ref1 = require('./pairs'), DI_BRK = _ref1.DI_BRK, IN_BRK = _ref1.IN_BRK, CI_BRK = _ref1.CI_BRK, CP_BRK = _ref1.CP_BRK, PR_BRK = _ref1.PR_BRK, pairTable = _ref1.pairTable;\n  data = base64.toByteArray(fs.readFileSync(__dirname + '/classes.trie', 'base64'));\n  classTrie = new UnicodeTrie(data);\n\n  LineBreaker = function () {\n    var Break, mapClass, mapFirst;\n\n    function LineBreaker(string) {\n      this.string = string;\n      this.pos = 0;\n      this.lastPos = 0;\n      this.curClass = null;\n      this.nextClass = null;\n    }\n\n    LineBreaker.prototype.nextCodePoint = function () {\n      var code, next;\n      code = this.string.charCodeAt(this.pos++);\n      next = this.string.charCodeAt(this.pos);\n\n      if (0xd800 <= code && code <= 0xdbff && 0xdc00 <= next && next <= 0xdfff) {\n        this.pos++;\n        return (code - 0xd800) * 0x400 + (next - 0xdc00) + 0x10000;\n      }\n\n      return code;\n    };\n\n    mapClass = function (c) {\n      switch (c) {\n        case AI:\n          return AL;\n\n        case SA:\n        case SG:\n        case XX:\n          return AL;\n\n        case CJ:\n          return NS;\n\n        default:\n          return c;\n      }\n    };\n\n    mapFirst = function (c) {\n      switch (c) {\n        case LF:\n        case NL:\n          return BK;\n\n        case CB:\n          return BA;\n\n        case SP:\n          return WJ;\n\n        default:\n          return c;\n      }\n    };\n\n    LineBreaker.prototype.nextCharClass = function (first) {\n      if (first == null) {\n        first = false;\n      }\n\n      return mapClass(classTrie.get(this.nextCodePoint()));\n    };\n\n    Break = function () {\n      function Break(position, required) {\n        this.position = position;\n        this.required = required != null ? required : false;\n      }\n\n      return Break;\n    }();\n\n    LineBreaker.prototype.nextBreak = function () {\n      var cur, lastClass, shouldBreak;\n\n      if (this.curClass == null) {\n        this.curClass = mapFirst(this.nextCharClass());\n      }\n\n      while (this.pos < this.string.length) {\n        this.lastPos = this.pos;\n        lastClass = this.nextClass;\n        this.nextClass = this.nextCharClass();\n\n        if (this.curClass === BK || this.curClass === CR && this.nextClass !== LF) {\n          this.curClass = mapFirst(mapClass(this.nextClass));\n          return new Break(this.lastPos, true);\n        }\n\n        cur = function () {\n          switch (this.nextClass) {\n            case SP:\n              return this.curClass;\n\n            case BK:\n            case LF:\n            case NL:\n              return BK;\n\n            case CR:\n              return CR;\n\n            case CB:\n              return BA;\n          }\n        }.call(this);\n\n        if (cur != null) {\n          this.curClass = cur;\n\n          if (this.nextClass === CB) {\n            return new Break(this.lastPos);\n          }\n\n          continue;\n        }\n\n        shouldBreak = false;\n\n        switch (pairTable[this.curClass][this.nextClass]) {\n          case DI_BRK:\n            shouldBreak = true;\n            break;\n\n          case IN_BRK:\n            shouldBreak = lastClass === SP;\n            break;\n\n          case CI_BRK:\n            shouldBreak = lastClass === SP;\n\n            if (!shouldBreak) {\n              continue;\n            }\n\n            break;\n\n          case CP_BRK:\n            if (lastClass !== SP) {\n              continue;\n            }\n\n        }\n\n        this.curClass = this.nextClass;\n\n        if (shouldBreak) {\n          return new Break(this.lastPos);\n        }\n      }\n\n      if (this.pos >= this.string.length) {\n        if (this.lastPos < this.string.length) {\n          this.lastPos = this.string.length;\n          return new Break(this.string.length);\n        } else {\n          return null;\n        }\n      }\n    };\n\n    return LineBreaker;\n  }();\n\n  module.exports = LineBreaker;\n}).call(this);","map":{"version":3,"sources":["/Users/kaja/Code/mallar/node_modules/linebreak/src/linebreaker.js"],"names":["AI","AL","BA","BK","CB","CI_BRK","CJ","CP_BRK","CR","DI_BRK","ID","IN_BRK","LF","LineBreaker","NL","NS","PR_BRK","SA","SG","SP","UnicodeTrie","WJ","XX","base64","characterClasses","classTrie","data","fs","pairTable","_ref","_ref1","require","toByteArray","readFileSync","__dirname","Break","mapClass","mapFirst","string","pos","lastPos","curClass","nextClass","prototype","nextCodePoint","code","next","charCodeAt","c","nextCharClass","first","get","position","required","nextBreak","cur","lastClass","shouldBreak","length","call","module","exports"],"mappings":"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","sourcesContent":["// Generated by CoffeeScript 1.7.1\n(function() {\n  var AI, AL, BA, BK, CB, CI_BRK, CJ, CP_BRK, CR, DI_BRK, ID, IN_BRK, LF, LineBreaker, NL, NS, PR_BRK, SA, SG, SP, UnicodeTrie, WJ, XX, base64, characterClasses, classTrie, data, fs, pairTable, _ref, _ref1;\n\n  UnicodeTrie = require('unicode-trie');\n\n  fs = require('fs');\n\n  base64 = require('base64-js');\n\n  _ref = require('./classes'), BK = _ref.BK, CR = _ref.CR, LF = _ref.LF, NL = _ref.NL, CB = _ref.CB, BA = _ref.BA, SP = _ref.SP, WJ = _ref.WJ, SP = _ref.SP, BK = _ref.BK, LF = _ref.LF, NL = _ref.NL, AI = _ref.AI, AL = _ref.AL, SA = _ref.SA, SG = _ref.SG, XX = _ref.XX, CJ = _ref.CJ, ID = _ref.ID, NS = _ref.NS, characterClasses = _ref.characterClasses;\n\n  _ref1 = require('./pairs'), DI_BRK = _ref1.DI_BRK, IN_BRK = _ref1.IN_BRK, CI_BRK = _ref1.CI_BRK, CP_BRK = _ref1.CP_BRK, PR_BRK = _ref1.PR_BRK, pairTable = _ref1.pairTable;\n\n  data = base64.toByteArray(fs.readFileSync(__dirname + '/classes.trie', 'base64'));\n\n  classTrie = new UnicodeTrie(data);\n\n  LineBreaker = (function() {\n    var Break, mapClass, mapFirst;\n\n    function LineBreaker(string) {\n      this.string = string;\n      this.pos = 0;\n      this.lastPos = 0;\n      this.curClass = null;\n      this.nextClass = null;\n    }\n\n    LineBreaker.prototype.nextCodePoint = function() {\n      var code, next;\n      code = this.string.charCodeAt(this.pos++);\n      next = this.string.charCodeAt(this.pos);\n      if ((0xd800 <= code && code <= 0xdbff) && (0xdc00 <= next && next <= 0xdfff)) {\n        this.pos++;\n        return ((code - 0xd800) * 0x400) + (next - 0xdc00) + 0x10000;\n      }\n      return code;\n    };\n\n    mapClass = function(c) {\n      switch (c) {\n        case AI:\n          return AL;\n        case SA:\n        case SG:\n        case XX:\n          return AL;\n        case CJ:\n          return NS;\n        default:\n          return c;\n      }\n    };\n\n    mapFirst = function(c) {\n      switch (c) {\n        case LF:\n        case NL:\n          return BK;\n        case CB:\n          return BA;\n        case SP:\n          return WJ;\n        default:\n          return c;\n      }\n    };\n\n    LineBreaker.prototype.nextCharClass = function(first) {\n      if (first == null) {\n        first = false;\n      }\n      return mapClass(classTrie.get(this.nextCodePoint()));\n    };\n\n    Break = (function() {\n      function Break(position, required) {\n        this.position = position;\n        this.required = required != null ? required : false;\n      }\n\n      return Break;\n\n    })();\n\n    LineBreaker.prototype.nextBreak = function() {\n      var cur, lastClass, shouldBreak;\n      if (this.curClass == null) {\n        this.curClass = mapFirst(this.nextCharClass());\n      }\n      while (this.pos < this.string.length) {\n        this.lastPos = this.pos;\n        lastClass = this.nextClass;\n        this.nextClass = this.nextCharClass();\n        if (this.curClass === BK || (this.curClass === CR && this.nextClass !== LF)) {\n          this.curClass = mapFirst(mapClass(this.nextClass));\n          return new Break(this.lastPos, true);\n        }\n        cur = (function() {\n          switch (this.nextClass) {\n            case SP:\n              return this.curClass;\n            case BK:\n            case LF:\n            case NL:\n              return BK;\n            case CR:\n              return CR;\n            case CB:\n              return BA;\n          }\n        }).call(this);\n        if (cur != null) {\n          this.curClass = cur;\n          if (this.nextClass === CB) {\n            return new Break(this.lastPos);\n          }\n          continue;\n        }\n        shouldBreak = false;\n        switch (pairTable[this.curClass][this.nextClass]) {\n          case DI_BRK:\n            shouldBreak = true;\n            break;\n          case IN_BRK:\n            shouldBreak = lastClass === SP;\n            break;\n          case CI_BRK:\n            shouldBreak = lastClass === SP;\n            if (!shouldBreak) {\n              continue;\n            }\n            break;\n          case CP_BRK:\n            if (lastClass !== SP) {\n              continue;\n            }\n        }\n        this.curClass = this.nextClass;\n        if (shouldBreak) {\n          return new Break(this.lastPos);\n        }\n      }\n      if (this.pos >= this.string.length) {\n        if (this.lastPos < this.string.length) {\n          this.lastPos = this.string.length;\n          return new Break(this.string.length);\n        } else {\n          return null;\n        }\n      }\n    };\n\n    return LineBreaker;\n\n  })();\n\n  module.exports = LineBreaker;\n\n}).call(this);\n"]},"metadata":{},"sourceType":"script"}